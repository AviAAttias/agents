version: "3.9"
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_DB: pipeline
      POSTGRES_USER: pipeline
      POSTGRES_PASSWORD: pipeline
    ports: ["5432:5432"]
  mailhog:
    image: mailhog/mailhog:latest
    ports: ["1025:1025", "8025:8025"]
  config-server:
    build: ./config-server
    ports: ["8888:8888"]
  pdf-ingestion-service:
    build: ./pdf-ingestion-service
    environment:
      DB_URL: jdbc:postgresql://postgres:5432/pipeline
      DB_USERNAME: pipeline
      DB_PASSWORD: pipeline
    depends_on: [postgres, config-server]
  text-extraction-worker:
    build: ./text-extraction-worker
    environment: &db
      DB_URL: jdbc:postgresql://postgres:5432/pipeline
      DB_USERNAME: pipeline
      DB_PASSWORD: pipeline
    depends_on: [postgres, config-server]
  classification-worker:
    build: ./classification-worker
    environment: *db
    depends_on: [postgres, config-server]
  financial-extraction-worker:
    build: ./financial-extraction-worker
    environment: *db
    depends_on: [postgres, config-server]
  reconciliation-worker:
    build: ./reconciliation-worker
    environment: *db
    depends_on: [postgres, config-server]
  reporting-worker:
    build: ./reporting-worker
    environment: *db
    depends_on: [postgres, config-server]
  approval-service:
    build: ./approval-service
    environment: *db
    depends_on: [postgres, config-server]
  notification-worker:
    build: ./notification-worker
    environment:
      <<: *db
      MAIL_HOST: mailhog
      MAIL_PORT: 1025
    depends_on: [postgres, mailhog, config-server]
